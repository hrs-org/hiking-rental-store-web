<div class="main-page">
  <app-pwa-header
    [title]="mode === 'edit' ? 'Edit Item' : 'Add Item'"
    [backButtonVisible]="true"
  ></app-pwa-header>

  <div class="content">
    <div class="container">
      <div class="card-info">
        <mat-form-field appearance="outline" style="width: 100%">
          <mat-label>Item Name</mat-label>
          <input
            matInput
            placeholder="Item Name"
            id="parentName"
            required
            [(ngModel)]="item.name"
          />
          @if (item.name === '') {
            <mat-error>Item Name is required</mat-error>
          }
        </mat-form-field>
        <mat-form-field appearance="outline" style="width: 100%">
          <mat-label>Item Description</mat-label>
          <textarea
            matInput
            id="parentDescription"
            required
            [(ngModel)]="item.description"
          ></textarea>
          @if (item.description === '') {
            <mat-error>Item Description is required</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" style="width: 100%">
          <mat-label class="stock-label">Quantity</mat-label>
          <input
            matInput
            type="number"
            class="stock-input"
            id="parentQuantity"
            min="0"
            [(ngModel)]="item.quantity"
          />
        </mat-form-field>
        <mat-form-field appearance="outline" style="width: 100%">
          <mat-label class="stock-label">Price</mat-label>
          <input
            matInput
            type="number"
            class="stock-input"
            id="parentPrice"
            min="0"
            [(ngModel)]="item.price"
          />
        </mat-form-field>
      </div>

      <div class="card-info">
        <div
          style="
            display: flex;
            flex-direction: row;
            gap: 12px;
            align-items: center;
            margin-bottom: 12px;
          "
        >
          <div class="card-title" style="margin-bottom: 0">Rates</div>
          <mat-slide-toggle [(ngModel)]="is_active"></mat-slide-toggle>
        </div>
        @if (is_active) {
          <div class="table-wrapper">
            <table mat-table class="table-rates" [dataSource]="item.rates">
              <ng-container matColumnDef="minDays">
                <th mat-header-cell *matHeaderCellDef>Min Days</th>
                <td mat-cell *matCellDef="let element">
                  <input
                    matInput
                    required
                    [(ngModel)]="element.minDays"
                    class="stock-input"
                    type="number"
                    min="0"
                  />
                </td>
              </ng-container>
              <ng-container matColumnDef="dailyRate">
                <th mat-header-cell *matHeaderCellDef>Daily Rate</th>
                <td mat-cell *matCellDef="let element">
                  <input
                    matInput
                    required
                    [(ngModel)]="element.dailyRate"
                    class="stock-input"
                    type="number"
                    min="0"
                  />
                </td>
              </ng-container>
              <ng-container matColumnDef="delete">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element">
                  <mat-icon (click)="deleteRate(element.id)">delete</mat-icon>
                </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
          </div>
          <div>
            <button mat-button (click)="addRate()">Add Rate</button>
          </div>
        }
      </div>
      <div class="card-info">
        <div class="card-title">Children</div>
        <div class="children-list" id="childrenList">
          @for (childrenItem of item.children; track childrenItem.id) {
            <div class="child-row">
              <mat-form-field appearance="outline" class="child-name-field">
                <mat-label>Child Item Name</mat-label>
                <input
                  matInput
                  required
                  type="text"
                  placeholder="Child Item Name"
                  id="childName_{{ childrenItem.id }}"
                  [(ngModel)]="childrenItem.name"
                />
              </mat-form-field>
              <mat-form-field appearance="outline" class="child-quantity-field">
                <mat-label>Quantity</mat-label>
                <input
                  matInput
                  type="number"
                  id="childQuantity_{{ childrenItem.id }}"
                  [(ngModel)]="childrenItem.quantity"
                  min="0"
                />
              </mat-form-field>
              <mat-icon class="delete-icon" (click)="deleteChildItem(childrenItem.id!)">
                delete
              </mat-icon>
            </div>
          }
        </div>
        <button mat-button (click)="addChildItem()">
          <mat-icon>add</mat-icon>
          Add Child Item
        </button>
      </div>
    </div>
  </div>

  <button class="save-btn" (click)="onSubmit()">Save</button>
</div>
