<div class="accordion">
  <div class="accordion-header" [ngClass]="{ expanded: expanded }">
    <div
      class="item-info"
      style="flex: 1"
      (click)="toggleExpand()"
      (keydown.enter)="toggleExpand()"
      tabindex="0"
    >
      <div class="item-name">
        {{ item.itemNameSnapshot }}
      </div>
      <div class="item-stock">Rented: {{ item.quantity }}</div>
    </div>

    <div class="qty-controls">
      <button
        mat-icon-button
        color="primary"
        (click)="changeQty(item.id, -1)"
        [disabled]="getQty(item.id) === 0"
      >
        <mat-icon>remove</mat-icon>
      </button>

      <span class="qty-value">{{ getQty(item.id) || 0 }}</span>

      <button
        mat-icon-button
        color="primary"
        (click)="changeQty(item.id, 1)"
        [disabled]="totalReturnQty() >= item.quantity"
      >
        <mat-icon>add</mat-icon>
      </button>
    </div>
  </div>

  @if (expanded) {
    <div class="accordion-body">
      <div class="child-row">
        <div class="item-info">
          <div class="child-name">Repair</div>
        </div>

        <div class="qty-controls">
          <button
            mat-icon-button
            color="primary"
            (click)="changeRepairQty(item.id, -1)"
            [disabled]="getRepairQty(item.id) === 0"
          >
            <mat-icon>remove</mat-icon>
          </button>

          <span class="qty-value">{{ getRepairQty(item.id) || 0 }}</span>

          <button
            mat-icon-button
            color="primary"
            (click)="changeRepairQty(item.id, 1)"
            [disabled]="totalReturnQty() >= item.quantity"
          >
            <mat-icon>add</mat-icon>
          </button>
        </div>
      </div>
      <div class="child-row">
        <div class="item-info">
          <div class="child-name">Damaged</div>
        </div>

        <div class="qty-controls">
          <button
            mat-icon-button
            color="primary"
            (click)="changeDamagedQty(item.id, -1)"
            [disabled]="getDamagedQty(item.id) === 0"
          >
            <mat-icon>remove</mat-icon>
          </button>

          <span class="qty-value">{{ getDamagedQty(item.id) || 0 }}</span>

          <button
            mat-icon-button
            color="primary"
            (click)="changeDamagedQty(item.id, 1)"
            [disabled]="totalReturnQty() >= item.quantity"
          >
            <mat-icon>add</mat-icon>
          </button>
        </div>
      </div>
      <div class="child-row">
        <div class="item-info">
          <div class="child-name">Lost</div>
        </div>

        <div class="qty-controls">
          <button
            mat-icon-button
            color="primary"
            (click)="changeLostQty(item.id, -1)"
            [disabled]="getLostQty(item.id) === 0"
          >
            <mat-icon>remove</mat-icon>
          </button>

          <span class="qty-value">{{ getLostQty(item.id) || 0 }}</span>

          <button
            mat-icon-button
            color="primary"
            (click)="changeLostQty(item.id, 1)"
            [disabled]="totalReturnQty() >= item.quantity"
          >
            <mat-icon>add</mat-icon>
          </button>
        </div>
      </div>
    </div>
  }
</div>
